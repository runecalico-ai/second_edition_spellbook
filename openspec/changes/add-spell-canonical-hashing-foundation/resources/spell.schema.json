{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://runecalico.ai/schemas/spell.schema.json",
    "title": "Spell",
    "description": "Canonical definition of a spell in the Second Edition Spellbook.",
    "type": "object",
    "properties": {
        "id": {
            "type": "string",
            "description": "The content-addressed hash identifier of the spell (SHA-256).",
            "pattern": "^[a-f0-9]{64}$"
        },
        "name": {
            "type": "string",
            "description": "The name of the spell.",
            "minLength": 1
        },
        "tradition": {
            "type": "string",
            "description": "The magical tradition of the spell.",
            "enum": [
                "ARCANE",
                "DIVINE",
                "BOTH"
            ]
        },
        "school": {
            "type": [
                "string",
                "null"
            ],
            "description": "The primary mechanical school of magic (for specialist rules).",
            "enum": [
                "Abjuration",
                "Alteration",
                "Calling",
                "Charm",
                "Conjuration",
                "Conjuration/Summoning",
                "Creation",
                "Dimension",
                "Divination",
                "Enchantment",
                "Enchantment/Charm",
                "Evocation",
                "Illusion",
                "Illusion/Phantasm",
                "Invocation",
                "Invocation/Evocation",
                "Necromancy",
                "Phantasm",
                "Shadow",
                "Summoning",
                "Teleportation",
                "Temporal",
                null
            ],
            "default": null
        },
        "subschools": {
            "type": "array",
            "description": "Secondary schools or specific disciplines (e.g. 'Evocation', 'Charm', 'Phantasm').",
            "items": {
                "type": "string"
            },
            "uniqueItems": true,
            "default": []
        },
        "descriptors": {
            "type": "array",
            "description": "Elemental, alignment, or planar descriptors (e.g. 'Fire', 'Mind-Affecting', 'Evil').",
            "items": {
                "type": "string"
            },
            "uniqueItems": true,
            "default": []
        },
        "sphere": {
            "type": [
                "string",
                "null"
            ],
            "description": "The divine sphere of influence (access control).",
            "enum": [
                "All",
                "Animal",
                "Astral",
                "Chaos",
                "Charm",
                "Combat",
                "Creation",
                "Desert",
                "Destiny",
                "Divination",
                "Drow",
                "Elemental Air",
                "Elemental Earth",
                "Elemental Fire",
                "Elemental Water",
                "Elemental Rain",
                "Elemental Sun",
                "Evil",
                "Fate",
                "Good",
                "Guardian",
                "Healing",
                "Law",
                "Magma",
                "Necromantic",
                "Numbers",
                "Plant",
                "Protection",
                "Silt",
                "Summoning",
                "Sun",
                "Thought",
                "Time",
                "Travelers",
                "War",
                "Weather",
                null
            ],
            "default": null
        },
        "class_list": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "description": "List of classes able to cast this spell (e.g., 'Wizard', 'Priest').",
            "uniqueItems": true,
            "default": []
        },
        "level": {
            "type": "integer",
            "description": "The spell level (0-12).",
            "minimum": 0,
            "maximum": 12
        },
        "range": {
            "type": "object",
            "properties": {
                "text": {
                    "type": "string",
                    "description": "Display range text (e.g. '10 yards + 10 yards / level')."
                },
                "unit": {
                    "type": "string",
                    "enum": [
                        "Touch",
                        "Yards",
                        "Feet",
                        "Miles",
                        "Special",
                        "Unlimited",
                        "Sight"
                    ],
                    "default": "Yards"
                },
                "base_value": {
                    "type": "number",
                    "description": "Fixed base range.",
                    "default": 0
                },
                "per_level": {
                    "type": "number",
                    "description": "Variable range added per increment.",
                    "default": 0
                },
                "level_divisor": {
                    "type": "number",
                    "description": "Level increment divisor.",
                    "default": 1
                }
            },
            "required": [
                "text",
                "unit"
            ],
            "additionalProperties": false
        },
        "components": {
            "type": "object",
            "properties": {
                "verbal": {
                    "type": "boolean",
                    "default": false
                },
                "somatic": {
                    "type": "boolean",
                    "default": false
                },
                "material": {
                    "type": "boolean",
                    "default": false
                }
            },
            "description": "Components required to cast the spell.",
            "additionalProperties": false,
            "required": [
                "verbal",
                "somatic",
                "material"
            ]
        },
        "material_components": {
            "type": [
                "string",
                "null"
            ],
            "description": "Description of material components.",
            "default": null
        },
        "casting_time": {
            "type": "object",
            "properties": {
                "text": {
                    "type": "string",
                    "description": "Display casting time text (e.g. '3', '1 round')."
                },
                "unit": {
                    "type": "string",
                    "enum": [
                        "Segment",
                        "Round",
                        "Turn",
                        "Hour",
                        "Special",
                        "Instantaneous"
                    ],
                    "default": "Segment"
                },
                "base_value": {
                    "type": "number",
                    "description": "Fixed base casting time value.",
                    "default": 1
                },
                "per_level": {
                    "type": "number",
                    "description": "Variable casting time added per increment.",
                    "default": 0
                },
                "level_divisor": {
                    "type": "number",
                    "description": "Level increment divisor.",
                    "default": 1
                }
            },
            "required": [
                "text",
                "unit"
            ],
            "additionalProperties": false
        },
        "duration": {
            "type": "object",
            "properties": {
                "text": {
                    "type": "string",
                    "description": "Display duration text (e.g. '1 round / level')."
                },
                "unit": {
                    "type": "string",
                    "enum": [
                        "Instantaneous",
                        "Round",
                        "Turn",
                        "Hour",
                        "Day",
                        "Week",
                        "Month",
                        "Year",
                        "Permanent",
                        "Special"
                    ],
                    "default": "Round"
                },
                "base_value": {
                    "type": "number",
                    "description": "Fixed base duration.",
                    "default": 0
                },
                "per_level": {
                    "type": "number",
                    "description": "Variable duration added per increment.",
                    "default": 0
                },
                "level_divisor": {
                    "type": "number",
                    "description": "Level increment divisor (e.g. 2 for 'per 2 levels').",
                    "default": 1
                }
            },
            "required": [
                "text",
                "unit"
            ],
            "additionalProperties": false
        },
        "area": {
            "type": "object",
            "properties": {
                "text": {
                    "type": "string",
                    "description": "Display area text (e.g. '10 ft. radius / level')."
                },
                "unit": {
                    "type": "string",
                    "enum": [
                        "Special",
                        "None",
                        "Square Feet",
                        "Cubic Feet",
                        "Square Yards",
                        "Cubic Yards",
                        "Foot Radius",
                        "Yard Radius",
                        "Mile Radius",
                        "Foot Cube",
                        "Yard Cube",
                        "Creature(s)",
                        "Path"
                    ],
                    "default": "Special"
                },
                "base_value": {
                    "type": "number",
                    "description": "Fixed base area amount.",
                    "default": 0
                },
                "per_level": {
                    "type": "number",
                    "description": "Variable area added per increment.",
                    "default": 0
                },
                "level_divisor": {
                    "type": "number",
                    "description": "Level increment divisor.",
                    "default": 1
                }
            },
            "required": [
                "text",
                "unit"
            ],
            "additionalProperties": false
        },
        "damage": {
            "type": "object",
            "properties": {
                "text": {
                    "type": "string",
                    "description": "Display damage text (e.g. '1d6 / level')."
                },
                "base_dice": {
                    "type": "string",
                    "description": "Fixed base damage dice (e.g. '1d8').",
                    "default": "0"
                },
                "per_level_dice": {
                    "type": "string",
                    "description": "Damage dice added per increment (e.g. '1d6').",
                    "default": "0"
                },
                "level_divisor": {
                    "type": "number",
                    "description": "Level increment divisor.",
                    "default": 1
                },
                "cap_level": {
                    "type": "number",
                    "description": "Maximum caster level to count for scaling."
                }
            },
            "required": [
                "text"
            ],
            "additionalProperties": false
        },
        "saving_throw": {
            "type": [
                "string",
                "null"
            ],
            "description": "Saving throw allowance (e.g., 'None', '1/2').",
            "default": null
        },
        "reversible": {
            "type": [
                "integer",
                "null"
            ],
            "description": "Whether the spell is reversible (0 = No, 1 = Yes).",
            "enum": [
                0,
                1
            ],
            "default": 0
        },
        "description": {
            "type": "string",
            "description": "Full description of the spell.",
            "minLength": 1
        },
        "tags": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "description": "Arbitrary tags for categorization.",
            "uniqueItems": true,
            "default": []
        },
        "source_refs": {
            "type": "array",
            "description": "List of source references for this spell.",
            "items": {
                "type": "object",
                "properties": {
                    "system": {
                        "type": "string",
                        "description": "Game system (e.g. 'AD&D 2e')."
                    },
                    "book": {
                        "type": "string",
                        "description": "Book title or collection name (e.g. 'Player's Handbook', 'Homebrew')."
                    },
                    "page": {
                        "type": [
                            "integer",
                            "string",
                            "null"
                        ],
                        "description": "Page number."
                    },
                    "note": {
                        "type": [
                            "string",
                            "null"
                        ],
                        "description": "Additional notes (e.g. 'errata')."
                    }
                },
                "required": [
                    "book"
                ]
            },
            "default": []
        },
        "edition": {
            "type": [
                "string",
                "null"
            ],
            "description": "Game edition (e.g., '2e').",
            "default": null
        },
        "author": {
            "type": [
                "string",
                "null"
            ],
            "description": "Author credit.",
            "default": null
        },
        "version": {
            "type": "string",
            "description": "Semantic version of the spell definition (e.g. '1.0.0').",
            "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
            "default": "1.0.0"
        },
        "license": {
            "type": [
                "string",
                "null"
            ],
            "description": "License information (e.g., 'OGL').",
            "default": null
        },
        "is_quest_spell": {
            "type": "integer",
            "description": "Whether this is a Quest spell (0 = No, 1 = Yes).",
            "enum": [
                0,
                1
            ],
            "default": 0
        },
        "is_cantrip": {
            "type": "integer",
            "description": "Whether this is a Cantrip (0 = No, 1 = Yes).",
            "enum": [
                0,
                1
            ],
            "default": 0
        }
    },
    "required": [
        "name",
        "level",
        "description",
        "tradition"
    ],
    "additionalProperties": false,
    "allOf": [
        {
            "if": {
                "properties": {
                    "tradition": {
                        "const": "ARCANE"
                    }
                }
            },
            "then": {
                "required": [
                    "school"
                ],
                "properties": {
                    "sphere": {
                        "const": null
                    }
                }
            }
        },
        {
            "if": {
                "properties": {
                    "tradition": {
                        "const": "DIVINE"
                    }
                }
            },
            "then": {
                "required": [
                    "sphere"
                ],
                "properties": {
                    "school": {
                        "const": null
                    }
                }
            }
        },
        {
            "if": {
                "properties": {
                    "tradition": {
                        "const": "BOTH"
                    }
                }
            },
            "then": {
                "required": [
                    "school",
                    "sphere"
                ]
            }
        }
    ]
}